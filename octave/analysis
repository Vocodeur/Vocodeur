#! /bin/octave
# Analysis part of the Vocoder on a WAVE file

# Retrieve samples and choose its size
samples = wavread(argv(){1});
samples = samples(3501:13500);
printf("Start analysis...\n");


# Number of samples
number_of_samples = rows(samples);
# Number of frequency bands (integral power of 2)
N = 2^7;
# Semi-duration of the window
M = 3*N;
# Window
h = sinc((-M:M)/N);

# Display samples
figure (1)
plot((1:number_of_samples), samples);
title("Samples");


# Display the window
figure(2);
plot((-M:M), h);
title("Window");


# Compute sequences for analysis
x = zeros(number_of_samples, N);
for i = (1:number_of_samples)
	hi = shift([h'; zeros(number_of_samples-columns(h), 1)], -M+i);
	xi = prod([samples, hi], 2);
	xi = [xi; zeros(N-mod(rows(xi), N), 1)];
	xi = reshape(xi, N, rows(xi)/N);
	x(i,:) = sum(xi');
	printf("%d/%d analysis sequences computed\n", i, number_of_samples);
endfor
X = fft(x);
# Here X match X~ in the paper, X_k(n) = W_N^-nk * X~_k(n)


# Display the ith analysis sequence
i = 100;
figure(3);
plot((1:number_of_samples), x(:,i));
title("Analysis sequence number 100");


printf("Analysis finished.\nPress any key to continue...");
pause();
